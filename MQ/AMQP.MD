AMQP (Advanced Message Queuing Protocol)
----------------------------------------------------------------------
高级消息队列协议（AMQP）是一个异步消息传递所使用的应用层协议规范。作为线路层协议，而不是API（例如JMS），AMQP 客户端能够无视消息的来源任意发送和接受信息。现在，已经有相当一部分不同平台的服务器和客户端可以投入使用。

### 核心概念介绍
#### Publisher 发布者
发布者可以发布（生产）消息
#### Consumer 消费者
消费者可以消费（消耗）消息
#### Exchange 交换机
交换机是用来发送消息的AMQP实体。常常被比喻成邮局或者邮箱。
交换机将收到的消息根据路由规则分发给绑定的队列（queue）。
##### 交换机类型

| Name（交换机类型）                | Default pre-declared names（预声明的默认名称） |
| --------------------------------- | ---------------------------------------------- |
| Direct exchange（直连交换机）默认 | (Empty string) and amq.direct                  |
| Fanout exchange（扇型交换机）     | amq.fanout                                     |
| Topic exchange（主题交换机）      | amq.topic                                      |
| Headers exchange（头交换机）      | amq.match (and amq.headers in RabbitMQ)        |

###### 直连交换机
直连型交换机（direct exchange）是根据消息携带的路由键（routing key）将消息投递给对应队列的。直连交换机用来处理消息的**单播路由（unicast routing）**（尽管它也可以处理多播路由）。

###### 扇形交换机
扇型交换机（funout exchange）将消息路由给绑定到它身上的所有队列，而不理会绑定的路由键。如果N个队列绑定到某个扇型交换机上，当有消息发送给此扇型交换机时，交换机会将消息的拷贝分别发送给这所有的N个队列。扇型用来交换机处理消息的**广播路由（broadcast routing）**。

###### 主题交换机
主题交换机（topic exchanges）通过对消息的路由键和队列到交换机的绑定模式之间的匹配，将消息路由给一个或多个队列。主题交换机经常用来实现各种分发/订阅模式及其变种。主题交换机通常用来实现消息的**多播路由（multicast routing）**。

###### 头交换机
有时消息的路由操作会涉及到多个属性，此时使用消息头就比用路由键更容易表达，头交换机（headers exchange）就是为此而生的。头交换机使用多个消息属性来代替路由键建立路由规则。**通过判断消息头的值能否与指定的绑定相匹配来确立路由规则。**

#### Queue 队列
存储消息的容器
##### 队列持久化
持久化队列（Durable queues）会被存储在磁盘上，当消息代理（broker）重启的时候，它依旧存在。没有被持久化的队列称作暂存队列（Transient queues）。并不是所有的场景和案例都需要将队列持久化。

持久化的队列并不会使得路由到它的消息也具有持久性。倘若消息代理挂掉了，重新启动，那么在重启的过程中持久化队列会被重新声明，无论怎样，只有经过持久化的消息才能被重新恢复。
#### Route 路由

#### Broker 代理

#### Topics 主题

#### Connections 连接
客户端connections是长连接。

#### Channels 通道

#### Vhosts 虚拟主机
为了在一个单独的代理上实现多个**隔离**的环境（用户、用户组、交换机、队列 等），AMQP提供了一个虚拟主机（virtual hosts - vhosts）的概念。这跟Web servers虚拟主机概念非常相似，这为AMQP实体提供了完全隔离的环境。当连接被建立的时候，AMQP客户端来指定使用哪个虚拟主机。

### 参考
- [AMQP 0-9-1 模型解析](http://rabbitmq.mr-ping.com/AMQP/AMQP_0-9-1_Model_Explained.html)